<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com. project.mapper.UserMapper">

<select id="readAuthorities" parameterType="String" resultType="org.springframework.security.core.authority.SimpleGrantedAuthority">
	SELECT u_auth
	FROM lc_auth
	WHERE 1=1
	AND u_id = #{userID}
</select>

<select id="readUser" parameterType="String" resultType="User">
	SELECT user_id as userID,
		   user_passwd,
		   user_name,
		   	u_isAccountNonExpired 		as 	isAccountNonExpired,
     		u_isAccountNonLocked 		as 	isAccountNonLocked,
       		u_isCredentialNonExpired 	as 	isCredentialsNonExpired,
        	u_isEnabled 				as 	isEnabled
    FROM	USer
    WHERE 1=1
    AND user_id = #{userID}

</select>

<insert id="createUser" parameterType="User">
	INSERT into User (
		user_id,
		user_name,
		user_passwd
		u_isAccountNonExpired,
		u_isAccountNonLocked,
		u_isCredentialNonExpired,
		u_isEnabled
	) VALUES (
		#{userID},
		#{user_passwd},
		#{user_name},
		#{isAccountNonExpired},
		#{isAccountNonLocked},
		#{isCredentialsNonExpired},
		#{isEnabled}
	)
</insert>

<insert id="createAuthority" parameterType="org.springframework.security.core.GrantedAuthority">
	INSERT INTO project_auth (
		user_id,
		user_auth
	) VALUES
	<foreach item="authority" index="index" collection="authorities" separator=",">
		(#{userID}, #{authority.role})
	</foreach>
	ON DUPLICATE KEY
		UPDATE
		user_id = #{userID}
</insert>

</mapper>